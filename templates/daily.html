{% extends "base.html" %}
{% block content %}
  <div class="bg-white rounded-2xl shadow p-0 overflow-hidden">
    <div class="px-4 py-3 bg-sky-50 border-b border-slate-200 flex items-center justify-between">
      <div class="text-sm text-slate-700">Profile code: <span id="profileCode" class="font-mono font-semibold">{{ profile_code }}</span></div>
      <div id="progress" class="text-sm text-slate-700">0 / 10</div>
    </div>
    <div id="results-toast" class="mx-4 my-3 text-sm rounded-lg border px-3 py-2" style="display:none;"></div>
    <div id="stage" class="p-4"></div>
    <div class="px-4 py-3 border-t border-slate-200 flex items-center justify-between bg-slate-50">
      <button id="prevBtn" class="px-4 py-2 rounded-xl bg-slate-200 text-slate-700 disabled:opacity-40" disabled>Back</button>
      <button id="nextBtn" class="px-4 py-2 rounded-xl bg-sky-600 text-white">Next</button>
    </div>
  </div>
  <script>
    const ITEMS = {{ items|safe }};
    const SESSION_ID = {{ session_id }};
  </script>
  <script src="/static/app.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      function _fallbackEnsureProfile(){
        let code = localStorage.getItem('profile_code');
        if(!code){
          code = 'LOCAL-' + Math.random().toString(36).slice(2,8).toUpperCase();
          localStorage.setItem('profile_code', code);
        }
        return code;
      }
      const code = (typeof ensureProfileCode === 'function') ? ensureProfileCode() : _fallbackEnsureProfile();
      const el = document.getElementById('profileCode');
      if (el) el.textContent = code;
    });
  </script>
{% endblock %}
